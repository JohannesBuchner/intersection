<!DOCTYPE html>
<html lang="en">
  <head>
      <meta charset="utf-8">
      <title>line - sphere intersection -- Intersection formulas for 3d objects</title>
  </head>
  <body>
<h2>line - sphere intersection</h2>
<h4>Equation for line (cartesian)</h4>
<ul>
<li>x: <img src="eq161.png" alt="t + x_{0}" /></li>
<li>y: <img src="eq162.png" alt="k t + y_{0}" /></li>
<li>z: <img src="eq163.png" alt="l t + z_{0}" /></li>
</ul>
<h4>Equation for sphere (cartesian)</h4>
<p>Assumed to be centred at 0, the coordinate system origin.</p>
0=<img src="eq164.png" alt="-1 + \frac{x^{2}}{R^{2}} + \frac{y^{2}}{R^{2}} + \frac{z^{2}}{R^{2}}" />
<h4>Intersection solutions</h4>
<p>Parametric solution (t). Solutions were derived automatically using sympy.</p>
<ul><li><img src="eq165.png" alt="\frac{1}{k^{2} + l^{2} + 1} \left(- k y_{0} - l z_{0} - x_{0} + \sqrt{R^{2} k^{2} + R^{2} l^{2} + R^{2} - k^{2} x_{0}^{2} - k^{2} z_{0}^{2} + 2 k l y_{0} z_{0} + 2 k x_{0} y_{0} - l^{2} x_{0}^{2} - l^{2} y_{0}^{2} + 2 l x_{0} z_{0} - y_{0}^{2} - z_{0}^{2}}\right)" /></li>
<li><img src="eq166.png" alt="- \frac{1}{k^{2} + l^{2} + 1} \left(k y_{0} + l z_{0} + x_{0} + \sqrt{R^{2} k^{2} + R^{2} l^{2} + R^{2} - k^{2} x_{0}^{2} - k^{2} z_{0}^{2} + 2 k l y_{0} z_{0} + 2 k x_{0} y_{0} - l^{2} x_{0}^{2} - l^{2} y_{0}^{2} + 2 l x_{0} z_{0} - y_{0}^{2} - z_{0}^{2}}\right)" /></li>
</ul><p>Points in cartesian coordinates (x, y, z)</p>
<ul><li><ul><li>x: <img src="eq167.png" alt="x_{0} + \frac{1}{k^{2} + l^{2} + 1} \left(- k y_{0} - l z_{0} - x_{0} + \sqrt{R^{2} k^{2} + R^{2} l^{2} + R^{2} - k^{2} x_{0}^{2} - k^{2} z_{0}^{2} + 2 k l y_{0} z_{0} + 2 k x_{0} y_{0} - l^{2} x_{0}^{2} - l^{2} y_{0}^{2} + 2 l x_{0} z_{0} - y_{0}^{2} - z_{0}^{2}}\right)" /></li>
<li>y: <img src="eq168.png" alt="\frac{k}{k^{2} + l^{2} + 1} \left(- k y_{0} - l z_{0} - x_{0} + \sqrt{R^{2} k^{2} + R^{2} l^{2} + R^{2} - k^{2} x_{0}^{2} - k^{2} z_{0}^{2} + 2 k l y_{0} z_{0} + 2 k x_{0} y_{0} - l^{2} x_{0}^{2} - l^{2} y_{0}^{2} + 2 l x_{0} z_{0} - y_{0}^{2} - z_{0}^{2}}\right) + y_{0}" /></li>
<li>z: <img src="eq169.png" alt="\frac{l}{k^{2} + l^{2} + 1} \left(- k y_{0} - l z_{0} - x_{0} + \sqrt{R^{2} k^{2} + R^{2} l^{2} + R^{2} - k^{2} x_{0}^{2} - k^{2} z_{0}^{2} + 2 k l y_{0} z_{0} + 2 k x_{0} y_{0} - l^{2} x_{0}^{2} - l^{2} y_{0}^{2} + 2 l x_{0} z_{0} - y_{0}^{2} - z_{0}^{2}}\right) + z_{0}" /></li>
</ul></li><li><ul><li>x: <img src="eq170.png" alt="x_{0} - \frac{1}{k^{2} + l^{2} + 1} \left(k y_{0} + l z_{0} + x_{0} + \sqrt{R^{2} k^{2} + R^{2} l^{2} + R^{2} - k^{2} x_{0}^{2} - k^{2} z_{0}^{2} + 2 k l y_{0} z_{0} + 2 k x_{0} y_{0} - l^{2} x_{0}^{2} - l^{2} y_{0}^{2} + 2 l x_{0} z_{0} - y_{0}^{2} - z_{0}^{2}}\right)" /></li>
<li>y: <img src="eq171.png" alt="- \frac{k}{k^{2} + l^{2} + 1} \left(k y_{0} + l z_{0} + x_{0} + \sqrt{R^{2} k^{2} + R^{2} l^{2} + R^{2} - k^{2} x_{0}^{2} - k^{2} z_{0}^{2} + 2 k l y_{0} z_{0} + 2 k x_{0} y_{0} - l^{2} x_{0}^{2} - l^{2} y_{0}^{2} + 2 l x_{0} z_{0} - y_{0}^{2} - z_{0}^{2}}\right) + y_{0}" /></li>
<li>z: <img src="eq172.png" alt="- \frac{l}{k^{2} + l^{2} + 1} \left(k y_{0} + l z_{0} + x_{0} + \sqrt{R^{2} k^{2} + R^{2} l^{2} + R^{2} - k^{2} x_{0}^{2} - k^{2} z_{0}^{2} + 2 k l y_{0} z_{0} + 2 k x_{0} y_{0} - l^{2} x_{0}^{2} - l^{2} y_{0}^{2} + 2 l x_{0} z_{0} - y_{0}^{2} - z_{0}^{2}}\right) + z_{0}" /></li>
</ul></li></ul><h5>C Code</h5>
<pre>x = x0 + (-k*y0 - l*z0 - x0 + sqrt(pow(R, 2)*pow(k, 2) + pow(R, 2)*pow(l, 2) + pow(R, 2) - pow(k, 2)*pow(x0, 2) - pow(k, 2)*pow(z0, 2) + 2*k*l*y0*z0 + 2*k*x0*y0 - pow(l, 2)*pow(x0, 2) - pow(l, 2)*pow(y0, 2) + 2*l*x0*z0 - pow(y0, 2) - pow(z0, 2)))/(pow(k, 2) + pow(l, 2) + 1);</pre>
<pre>y = k*(-k*y0 - l*z0 - x0 + sqrt(pow(R, 2)*pow(k, 2) + pow(R, 2)*pow(l, 2) + pow(R, 2) - pow(k, 2)*pow(x0, 2) - pow(k, 2)*pow(z0, 2) + 2*k*l*y0*z0 + 2*k*x0*y0 - pow(l, 2)*pow(x0, 2) - pow(l, 2)*pow(y0, 2) + 2*l*x0*z0 - pow(y0, 2) - pow(z0, 2)))/(pow(k, 2) + pow(l, 2) + 1) + y0;</pre>
<pre>z = l*(-k*y0 - l*z0 - x0 + sqrt(pow(R, 2)*pow(k, 2) + pow(R, 2)*pow(l, 2) + pow(R, 2) - pow(k, 2)*pow(x0, 2) - pow(k, 2)*pow(z0, 2) + 2*k*l*y0*z0 + 2*k*x0*y0 - pow(l, 2)*pow(x0, 2) - pow(l, 2)*pow(y0, 2) + 2*l*x0*z0 - pow(y0, 2) - pow(z0, 2)))/(pow(k, 2) + pow(l, 2) + 1) + z0;</pre>
<pre>x = x0 - (k*y0 + l*z0 + x0 + sqrt(pow(R, 2)*pow(k, 2) + pow(R, 2)*pow(l, 2) + pow(R, 2) - pow(k, 2)*pow(x0, 2) - pow(k, 2)*pow(z0, 2) + 2*k*l*y0*z0 + 2*k*x0*y0 - pow(l, 2)*pow(x0, 2) - pow(l, 2)*pow(y0, 2) + 2*l*x0*z0 - pow(y0, 2) - pow(z0, 2)))/(pow(k, 2) + pow(l, 2) + 1);</pre>
<pre>y = -k*(k*y0 + l*z0 + x0 + sqrt(pow(R, 2)*pow(k, 2) + pow(R, 2)*pow(l, 2) + pow(R, 2) - pow(k, 2)*pow(x0, 2) - pow(k, 2)*pow(z0, 2) + 2*k*l*y0*z0 + 2*k*x0*y0 - pow(l, 2)*pow(x0, 2) - pow(l, 2)*pow(y0, 2) + 2*l*x0*z0 - pow(y0, 2) - pow(z0, 2)))/(pow(k, 2) + pow(l, 2) + 1) + y0;</pre>
<pre>z = -l*(k*y0 + l*z0 + x0 + sqrt(pow(R, 2)*pow(k, 2) + pow(R, 2)*pow(l, 2) + pow(R, 2) - pow(k, 2)*pow(x0, 2) - pow(k, 2)*pow(z0, 2) + 2*k*l*y0*z0 + 2*k*x0*y0 - pow(l, 2)*pow(x0, 2) - pow(l, 2)*pow(y0, 2) + 2*l*x0*z0 - pow(y0, 2) - pow(z0, 2)))/(pow(k, 2) + pow(l, 2) + 1) + z0;</pre>
<h4>Distance inside</h4>
<p>Distance between crossing points.</p>
<img src="eq173.png" alt="2 \left\lvert{\frac{1}{k^{2} + l^{2} + 1} \sqrt{R^{2} k^{2} + R^{2} l^{2} + R^{2} - k^{2} x_{0}^{2} - k^{2} z_{0}^{2} + 2 k l y_{0} z_{0} + 2 k x_{0} y_{0} - l^{2} x_{0}^{2} - l^{2} y_{0}^{2} + 2 l x_{0} z_{0} - y_{0}^{2} - z_{0}^{2}}}\right\rvert" />
<h4>C Code</h4>
<pre>sol1 = (-k*y0 - l*z0 - x0 + sqrt(pow(R, 2)*pow(k, 2) + pow(R, 2)*pow(l, 2) + pow(R, 2) - pow(k, 2)*pow(x0, 2) - pow(k, 2)*pow(z0, 2) + 2*k*l*y0*z0 + 2*k*x0*y0 - pow(l, 2)*pow(x0, 2) - pow(l, 2)*pow(y0, 2) + 2*l*x0*z0 - pow(y0, 2) - pow(z0, 2)))/(pow(k, 2) + pow(l, 2) + 1);</pre><pre>sol2 = -(k*y0 + l*z0 + x0 + sqrt(pow(R, 2)*pow(k, 2) + pow(R, 2)*pow(l, 2) + pow(R, 2) - pow(k, 2)*pow(x0, 2) - pow(k, 2)*pow(z0, 2) + 2*k*l*y0*z0 + 2*k*x0*y0 - pow(l, 2)*pow(x0, 2) - pow(l, 2)*pow(y0, 2) + 2*l*x0*z0 - pow(y0, 2) - pow(z0, 2)))/(pow(k, 2) + pow(l, 2) + 1);</pre><pre>distance = 2*fabs(sqrt(pow(R, 2)*pow(k, 2) + pow(R, 2)*pow(l, 2) + pow(R, 2) - pow(k, 2)*pow(x0, 2) - pow(k, 2)*pow(z0, 2) + 2*k*l*y0*z0 + 2*k*x0*y0 - pow(l, 2)*pow(x0, 2) - pow(l, 2)*pow(y0, 2) + 2*l*x0*z0 - pow(y0, 2) - pow(z0, 2))/(pow(k, 2) + pow(l, 2) + 1));</pre><hr/>
<h4>Equation for line (spherical)</h4>
<ul>
<li>x: <img src="eq174.png" alt="t \sin{\left (\theta \right )} \cos{\left (\phi \right )} + x_{0}" /></li>
<li>y: <img src="eq175.png" alt="t \sin{\left (\phi \right )} \sin{\left (\theta \right )} + y_{0}" /></li>
<li>z: <img src="eq176.png" alt="t \cos{\left (\theta \right )} + z_{0}" /></li>
</ul>
<h4>Equation for sphere (cartesian)</h4>
<p>Assumed to be centred at 0, the coordinate system origin.</p>
0=<img src="eq177.png" alt="-1 + \frac{x^{2}}{R^{2}} + \frac{y^{2}}{R^{2}} + \frac{z^{2}}{R^{2}}" />
<h4>Intersection solutions</h4>
<p>Parametric solution (t). Solutions were derived automatically using sympy.</p>
<ul><li><img src="eq178.png" alt="- x_{0} \sin{\left (\theta \right )} \cos{\left (\phi \right )} - y_{0} \sin{\left (\phi \right )} \sin{\left (\theta \right )} - z_{0} \cos{\left (\theta \right )} - \sqrt{R^{2} - x_{0}^{2} \sin^{2}{\left (\phi \right )} \sin^{2}{\left (\theta \right )} + x_{0}^{2} \sin^{2}{\left (\theta \right )} - x_{0}^{2} + 2 x_{0} y_{0} \sin{\left (\phi \right )} \sin^{2}{\left (\theta \right )} \cos{\left (\phi \right )} + 2 x_{0} z_{0} \sin{\left (\theta \right )} \cos{\left (\phi \right )} \cos{\left (\theta \right )} + y_{0}^{2} \sin^{2}{\left (\phi \right )} \sin^{2}{\left (\theta \right )} - y_{0}^{2} + 2 y_{0} z_{0} \sin{\left (\phi \right )} \sin{\left (\theta \right )} \cos{\left (\theta \right )} - z_{0}^{2} \sin^{2}{\left (\theta \right )}}" /></li>
<li><img src="eq179.png" alt="- x_{0} \sin{\left (\theta \right )} \cos{\left (\phi \right )} - y_{0} \sin{\left (\phi \right )} \sin{\left (\theta \right )} - z_{0} \cos{\left (\theta \right )} + \sqrt{R^{2} - x_{0}^{2} \sin^{2}{\left (\phi \right )} \sin^{2}{\left (\theta \right )} + x_{0}^{2} \sin^{2}{\left (\theta \right )} - x_{0}^{2} + 2 x_{0} y_{0} \sin{\left (\phi \right )} \sin^{2}{\left (\theta \right )} \cos{\left (\phi \right )} + 2 x_{0} z_{0} \sin{\left (\theta \right )} \cos{\left (\phi \right )} \cos{\left (\theta \right )} + y_{0}^{2} \sin^{2}{\left (\phi \right )} \sin^{2}{\left (\theta \right )} - y_{0}^{2} + 2 y_{0} z_{0} \sin{\left (\phi \right )} \sin{\left (\theta \right )} \cos{\left (\theta \right )} - z_{0}^{2} \sin^{2}{\left (\theta \right )}}" /></li>
</ul><p>Points in cartesian coordinates (x, y, z)</p>
<ul><li><ul><li>x: <img src="eq180.png" alt="x_{0} + \left(- x_{0} \sin{\left (\theta \right )} \cos{\left (\phi \right )} - y_{0} \sin{\left (\phi \right )} \sin{\left (\theta \right )} - z_{0} \cos{\left (\theta \right )} - \sqrt{R^{2} - x_{0}^{2} \sin^{2}{\left (\phi \right )} \sin^{2}{\left (\theta \right )} + x_{0}^{2} \sin^{2}{\left (\theta \right )} - x_{0}^{2} + 2 x_{0} y_{0} \sin{\left (\phi \right )} \sin^{2}{\left (\theta \right )} \cos{\left (\phi \right )} + 2 x_{0} z_{0} \sin{\left (\theta \right )} \cos{\left (\phi \right )} \cos{\left (\theta \right )} + y_{0}^{2} \sin^{2}{\left (\phi \right )} \sin^{2}{\left (\theta \right )} - y_{0}^{2} + 2 y_{0} z_{0} \sin{\left (\phi \right )} \sin{\left (\theta \right )} \cos{\left (\theta \right )} - z_{0}^{2} \sin^{2}{\left (\theta \right )}}\right) \sin{\left (\theta \right )} \cos{\left (\phi \right )}" /></li>
<li>y: <img src="eq181.png" alt="y_{0} + \left(- x_{0} \sin{\left (\theta \right )} \cos{\left (\phi \right )} - y_{0} \sin{\left (\phi \right )} \sin{\left (\theta \right )} - z_{0} \cos{\left (\theta \right )} - \sqrt{R^{2} - x_{0}^{2} \sin^{2}{\left (\phi \right )} \sin^{2}{\left (\theta \right )} + x_{0}^{2} \sin^{2}{\left (\theta \right )} - x_{0}^{2} + 2 x_{0} y_{0} \sin{\left (\phi \right )} \sin^{2}{\left (\theta \right )} \cos{\left (\phi \right )} + 2 x_{0} z_{0} \sin{\left (\theta \right )} \cos{\left (\phi \right )} \cos{\left (\theta \right )} + y_{0}^{2} \sin^{2}{\left (\phi \right )} \sin^{2}{\left (\theta \right )} - y_{0}^{2} + 2 y_{0} z_{0} \sin{\left (\phi \right )} \sin{\left (\theta \right )} \cos{\left (\theta \right )} - z_{0}^{2} \sin^{2}{\left (\theta \right )}}\right) \sin{\left (\phi \right )} \sin{\left (\theta \right )}" /></li>
<li>z: <img src="eq182.png" alt="z_{0} + \left(- x_{0} \sin{\left (\theta \right )} \cos{\left (\phi \right )} - y_{0} \sin{\left (\phi \right )} \sin{\left (\theta \right )} - z_{0} \cos{\left (\theta \right )} - \sqrt{R^{2} - x_{0}^{2} \sin^{2}{\left (\phi \right )} \sin^{2}{\left (\theta \right )} + x_{0}^{2} \sin^{2}{\left (\theta \right )} - x_{0}^{2} + 2 x_{0} y_{0} \sin{\left (\phi \right )} \sin^{2}{\left (\theta \right )} \cos{\left (\phi \right )} + 2 x_{0} z_{0} \sin{\left (\theta \right )} \cos{\left (\phi \right )} \cos{\left (\theta \right )} + y_{0}^{2} \sin^{2}{\left (\phi \right )} \sin^{2}{\left (\theta \right )} - y_{0}^{2} + 2 y_{0} z_{0} \sin{\left (\phi \right )} \sin{\left (\theta \right )} \cos{\left (\theta \right )} - z_{0}^{2} \sin^{2}{\left (\theta \right )}}\right) \cos{\left (\theta \right )}" /></li>
</ul></li><li><ul><li>x: <img src="eq183.png" alt="x_{0} + \left(- x_{0} \sin{\left (\theta \right )} \cos{\left (\phi \right )} - y_{0} \sin{\left (\phi \right )} \sin{\left (\theta \right )} - z_{0} \cos{\left (\theta \right )} + \sqrt{R^{2} - x_{0}^{2} \sin^{2}{\left (\phi \right )} \sin^{2}{\left (\theta \right )} + x_{0}^{2} \sin^{2}{\left (\theta \right )} - x_{0}^{2} + 2 x_{0} y_{0} \sin{\left (\phi \right )} \sin^{2}{\left (\theta \right )} \cos{\left (\phi \right )} + 2 x_{0} z_{0} \sin{\left (\theta \right )} \cos{\left (\phi \right )} \cos{\left (\theta \right )} + y_{0}^{2} \sin^{2}{\left (\phi \right )} \sin^{2}{\left (\theta \right )} - y_{0}^{2} + 2 y_{0} z_{0} \sin{\left (\phi \right )} \sin{\left (\theta \right )} \cos{\left (\theta \right )} - z_{0}^{2} \sin^{2}{\left (\theta \right )}}\right) \sin{\left (\theta \right )} \cos{\left (\phi \right )}" /></li>
<li>y: <img src="eq184.png" alt="y_{0} + \left(- x_{0} \sin{\left (\theta \right )} \cos{\left (\phi \right )} - y_{0} \sin{\left (\phi \right )} \sin{\left (\theta \right )} - z_{0} \cos{\left (\theta \right )} + \sqrt{R^{2} - x_{0}^{2} \sin^{2}{\left (\phi \right )} \sin^{2}{\left (\theta \right )} + x_{0}^{2} \sin^{2}{\left (\theta \right )} - x_{0}^{2} + 2 x_{0} y_{0} \sin{\left (\phi \right )} \sin^{2}{\left (\theta \right )} \cos{\left (\phi \right )} + 2 x_{0} z_{0} \sin{\left (\theta \right )} \cos{\left (\phi \right )} \cos{\left (\theta \right )} + y_{0}^{2} \sin^{2}{\left (\phi \right )} \sin^{2}{\left (\theta \right )} - y_{0}^{2} + 2 y_{0} z_{0} \sin{\left (\phi \right )} \sin{\left (\theta \right )} \cos{\left (\theta \right )} - z_{0}^{2} \sin^{2}{\left (\theta \right )}}\right) \sin{\left (\phi \right )} \sin{\left (\theta \right )}" /></li>
<li>z: <img src="eq185.png" alt="z_{0} + \left(- x_{0} \sin{\left (\theta \right )} \cos{\left (\phi \right )} - y_{0} \sin{\left (\phi \right )} \sin{\left (\theta \right )} - z_{0} \cos{\left (\theta \right )} + \sqrt{R^{2} - x_{0}^{2} \sin^{2}{\left (\phi \right )} \sin^{2}{\left (\theta \right )} + x_{0}^{2} \sin^{2}{\left (\theta \right )} - x_{0}^{2} + 2 x_{0} y_{0} \sin{\left (\phi \right )} \sin^{2}{\left (\theta \right )} \cos{\left (\phi \right )} + 2 x_{0} z_{0} \sin{\left (\theta \right )} \cos{\left (\phi \right )} \cos{\left (\theta \right )} + y_{0}^{2} \sin^{2}{\left (\phi \right )} \sin^{2}{\left (\theta \right )} - y_{0}^{2} + 2 y_{0} z_{0} \sin{\left (\phi \right )} \sin{\left (\theta \right )} \cos{\left (\theta \right )} - z_{0}^{2} \sin^{2}{\left (\theta \right )}}\right) \cos{\left (\theta \right )}" /></li>
</ul></li></ul><h5>C Code</h5>
<pre>x = x0 + (-x0*sin(theta)*cos(phi) - y0*sin(phi)*sin(theta) - z0*cos(theta) - sqrt(pow(R, 2) - pow(x0, 2)*pow(sin(phi), 2)*pow(sin(theta), 2) + pow(x0, 2)*pow(sin(theta), 2) - pow(x0, 2) + 2*x0*y0*sin(phi)*pow(sin(theta), 2)*cos(phi) + 2*x0*z0*sin(theta)*cos(phi)*cos(theta) + pow(y0, 2)*pow(sin(phi), 2)*pow(sin(theta), 2) - pow(y0, 2) + 2*y0*z0*sin(phi)*sin(theta)*cos(theta) - pow(z0, 2)*pow(sin(theta), 2)))*sin(theta)*cos(phi);</pre>
<pre>y = y0 + (-x0*sin(theta)*cos(phi) - y0*sin(phi)*sin(theta) - z0*cos(theta) - sqrt(pow(R, 2) - pow(x0, 2)*pow(sin(phi), 2)*pow(sin(theta), 2) + pow(x0, 2)*pow(sin(theta), 2) - pow(x0, 2) + 2*x0*y0*sin(phi)*pow(sin(theta), 2)*cos(phi) + 2*x0*z0*sin(theta)*cos(phi)*cos(theta) + pow(y0, 2)*pow(sin(phi), 2)*pow(sin(theta), 2) - pow(y0, 2) + 2*y0*z0*sin(phi)*sin(theta)*cos(theta) - pow(z0, 2)*pow(sin(theta), 2)))*sin(phi)*sin(theta);</pre>
<pre>z = z0 + (-x0*sin(theta)*cos(phi) - y0*sin(phi)*sin(theta) - z0*cos(theta) - sqrt(pow(R, 2) - pow(x0, 2)*pow(sin(phi), 2)*pow(sin(theta), 2) + pow(x0, 2)*pow(sin(theta), 2) - pow(x0, 2) + 2*x0*y0*sin(phi)*pow(sin(theta), 2)*cos(phi) + 2*x0*z0*sin(theta)*cos(phi)*cos(theta) + pow(y0, 2)*pow(sin(phi), 2)*pow(sin(theta), 2) - pow(y0, 2) + 2*y0*z0*sin(phi)*sin(theta)*cos(theta) - pow(z0, 2)*pow(sin(theta), 2)))*cos(theta);</pre>
<pre>x = x0 + (-x0*sin(theta)*cos(phi) - y0*sin(phi)*sin(theta) - z0*cos(theta) + sqrt(pow(R, 2) - pow(x0, 2)*pow(sin(phi), 2)*pow(sin(theta), 2) + pow(x0, 2)*pow(sin(theta), 2) - pow(x0, 2) + 2*x0*y0*sin(phi)*pow(sin(theta), 2)*cos(phi) + 2*x0*z0*sin(theta)*cos(phi)*cos(theta) + pow(y0, 2)*pow(sin(phi), 2)*pow(sin(theta), 2) - pow(y0, 2) + 2*y0*z0*sin(phi)*sin(theta)*cos(theta) - pow(z0, 2)*pow(sin(theta), 2)))*sin(theta)*cos(phi);</pre>
<pre>y = y0 + (-x0*sin(theta)*cos(phi) - y0*sin(phi)*sin(theta) - z0*cos(theta) + sqrt(pow(R, 2) - pow(x0, 2)*pow(sin(phi), 2)*pow(sin(theta), 2) + pow(x0, 2)*pow(sin(theta), 2) - pow(x0, 2) + 2*x0*y0*sin(phi)*pow(sin(theta), 2)*cos(phi) + 2*x0*z0*sin(theta)*cos(phi)*cos(theta) + pow(y0, 2)*pow(sin(phi), 2)*pow(sin(theta), 2) - pow(y0, 2) + 2*y0*z0*sin(phi)*sin(theta)*cos(theta) - pow(z0, 2)*pow(sin(theta), 2)))*sin(phi)*sin(theta);</pre>
<pre>z = z0 + (-x0*sin(theta)*cos(phi) - y0*sin(phi)*sin(theta) - z0*cos(theta) + sqrt(pow(R, 2) - pow(x0, 2)*pow(sin(phi), 2)*pow(sin(theta), 2) + pow(x0, 2)*pow(sin(theta), 2) - pow(x0, 2) + 2*x0*y0*sin(phi)*pow(sin(theta), 2)*cos(phi) + 2*x0*z0*sin(theta)*cos(phi)*cos(theta) + pow(y0, 2)*pow(sin(phi), 2)*pow(sin(theta), 2) - pow(y0, 2) + 2*y0*z0*sin(phi)*sin(theta)*cos(theta) - pow(z0, 2)*pow(sin(theta), 2)))*cos(theta);</pre>
<h4>Distance inside</h4>
<p>Distance between crossing points.</p>
<img src="eq186.png" alt="2 \left\lvert{\sqrt{R^{2} - x_{0}^{2} \sin^{2}{\left (\phi \right )} \sin^{2}{\left (\theta \right )} + x_{0}^{2} \sin^{2}{\left (\theta \right )} - x_{0}^{2} + 2 x_{0} y_{0} \sin{\left (\phi \right )} \sin^{2}{\left (\theta \right )} \cos{\left (\phi \right )} + 2 x_{0} z_{0} \sin{\left (\theta \right )} \cos{\left (\phi \right )} \cos{\left (\theta \right )} + y_{0}^{2} \sin^{2}{\left (\phi \right )} \sin^{2}{\left (\theta \right )} - y_{0}^{2} + 2 y_{0} z_{0} \sin{\left (\phi \right )} \sin{\left (\theta \right )} \cos{\left (\theta \right )} - z_{0}^{2} \sin^{2}{\left (\theta \right )}}}\right\rvert" />
<h4>C Code</h4>
<pre>sol1 = -x0*sin(theta)*cos(phi) - y0*sin(phi)*sin(theta) - z0*cos(theta) - sqrt(pow(R, 2) - pow(x0, 2)*pow(sin(phi), 2)*pow(sin(theta), 2) + pow(x0, 2)*pow(sin(theta), 2) - pow(x0, 2) + 2*x0*y0*sin(phi)*pow(sin(theta), 2)*cos(phi) + 2*x0*z0*sin(theta)*cos(phi)*cos(theta) + pow(y0, 2)*pow(sin(phi), 2)*pow(sin(theta), 2) - pow(y0, 2) + 2*y0*z0*sin(phi)*sin(theta)*cos(theta) - pow(z0, 2)*pow(sin(theta), 2));</pre><pre>sol2 = -x0*sin(theta)*cos(phi) - y0*sin(phi)*sin(theta) - z0*cos(theta) + sqrt(pow(R, 2) - pow(x0, 2)*pow(sin(phi), 2)*pow(sin(theta), 2) + pow(x0, 2)*pow(sin(theta), 2) - pow(x0, 2) + 2*x0*y0*sin(phi)*pow(sin(theta), 2)*cos(phi) + 2*x0*z0*sin(theta)*cos(phi)*cos(theta) + pow(y0, 2)*pow(sin(phi), 2)*pow(sin(theta), 2) - pow(y0, 2) + 2*y0*z0*sin(phi)*sin(theta)*cos(theta) - pow(z0, 2)*pow(sin(theta), 2));</pre><pre>distance = 2*fabs(sqrt(pow(R, 2) - pow(x0, 2)*pow(sin(phi), 2)*pow(sin(theta), 2) + pow(x0, 2)*pow(sin(theta), 2) - pow(x0, 2) + 2*x0*y0*sin(phi)*pow(sin(theta), 2)*cos(phi) + 2*x0*z0*sin(theta)*cos(phi)*cos(theta) + pow(y0, 2)*pow(sin(phi), 2)*pow(sin(theta), 2) - pow(y0, 2) + 2*y0*z0*sin(phi)*sin(theta)*cos(theta) - pow(z0, 2)*pow(sin(theta), 2)));</pre><hr/>
